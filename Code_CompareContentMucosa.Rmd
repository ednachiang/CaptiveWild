---
title: "Compare Content vs. Mucosa"
author: "Edna Chiang"
date: "3/30/2021"
output: html_document
---

### Load Libraries
```{r}
library(ape)
library(dplyr)
library(dunn.test)
library(ggplot2)
library(grid)
library(phyloseq)
library(picante)
library(tidyr)
library(vegan)

theme_set(theme_bw())
set.seed(1)
```

### Load Functions
```{r}
source('scripts/misc.R')
```

### Import Data
```{r}
# Link files
shared = "mothur_output/final.shared"
taxonomy = "mothur_output/final.taxonomy"
tree = "mothur_output/final.tre"

# Import mothur data
mothurdata = import_mothur(
  mothur_shared_file = shared,
  mothur_constaxonomy_file = taxonomy,
  mothur_tree_file = tree)

# Add OTU column in taxonomy table
tax_table(mothurdata) <- cbind(tax_table(mothurdata), 
                               row.names(tax_table(mothurdata)))

# Rename taxonomy table columns
colnames(tax_table(mothurdata)) <- 
  c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")

# Remove OTUs that appear in < 3 samples
otu <- data.frame(otu_table(mothurdata))
otu.rem <- list()
for(i in 1:nrow(otu)){
  empty <- length(which(otu[i,] == 0))
    # Identifies # of samples w/o OTU
  if(empty > 54){
    # If OTU appears in < 3 samples
    otu.rem <- append(otu.rem, i)
      # Create list of OTUs that appear in only 1 sample
  }
}
otu.rem.row <- as.numeric(otu.rem)
  # Convert list to numeric
otu.rem.df <- otu[-otu.rem.row,]
  # Remove OTUs
otu.rem.tab <- otu_table(otu.rem.df, taxa_are_rows = T)
  # Convert trimmed OTU table to otu_table

# Add metadata
meta <- read.csv("metadata.csv")
rownames(meta) <- meta$Sample
divsum <- read.table("mothur_output/final.summary", header = T)
meta[,12:21] <- divsum[,3:12]

# Update phyloseq object
physeq <- merge_phyloseq(otu.rem.tab, tax_table(mothurdata), sample_data(meta),
                         phy_tree(mothurdata))

# Order factors
sample_data(physeq)$Season <- ordered(sample_data(physeq)$Season,
                                     levels=c("Summer", "Winter", "Spring"))
sample_data(physeq)$Metabolism <- ordered(sample_data(physeq)$Metabolism,
                                     levels=c("Active", "Torpor", "IBA"))
sample_data(physeq)$Group <- ordered(sample_data(physeq)$Group,
                                     levels=c("Summer_Wild", "Summer_Captive", "Torpor", "IBA", "Spring"))

# Remove outliers
physeq <- subset_samples(physeq, ID != 3925)
physeq <- subset_samples(physeq, ID != 3916)

# Subset out unpaired samples
physeq.pair <- subset_samples(physeq, ID != 3881)
physeq.pair <- subset_samples(physeq.pair, ID != 3886)
physeq.pair <- subset_samples(physeq.pair, ID != 4057)

# Separate by season
physeq.wild <- subset_samples(physeq.pair, Group == "Summer_Wild")
physeq.sum <- subset_samples(physeq.pair, Group == "Summer_Captive")
physeq.tor <- subset_samples(physeq.pair, Group == "Torpor")
physeq.iba <- subset_samples(physeq.pair, Group == "IBA")
physeq.spr <- subset_samples(physeq.pair, Group == "Spring")

# Separate by content/mucosa
physeq.con <- subset_samples(physeq.pair, Sample_Type == "Content")
physeq.muc <- subset_samples(physeq.pair, Sample_Type == "Mucosa")

```







### Alpha Div - Summer Wild
```{r}
########## FAITH'S PHYLOGENETIC DIVERSITY AND PHYLOGENETIC EVENNESS (MPD) ##########

# Calculate Faith's phylogenetic diversity
pd.wild.res <- pd(t(data.frame(otu_table(physeq.wild))), phy_tree(physeq.wild), 
             include.root = T)
pd.wild.df <- data.frame(pd.wild.res)

# Calculate MPD (Mean Pairwise Distance)
pd.wild.dist <- cophenetic(phy_tree(physeq.wild))
  # Calculate cophenetic distance

ses.mpd.wild.res <- ses.mpd(t(data.frame(otu_table(physeq.wild))), pd.wild.dist, 
                       null.model = "taxa.labels", abundance.weighted = F, runs = 999)
  # Calculate Mpd.wild
  # This'll take a while to run-- be patient

mpd.wild <- data.frame(ses.mpd.wild.res)
  # Pull out MDP results

### Prepare data for plotting ###
mpd.wild$SampleID <- row.names(mpd.wild)
pd.wild.res$SampleID <- row.names(pd.wild.res)
  # Make sure all SampleID's match!


# Pull out first Stat of each test
# PD test = PD
# MPD test = SES (Standardized Effect Size)
pd.wild.stats <- data.frame(pd.wild.res$SampleID, pd.wild.res$PD)
pd.wild.stats$Measure <- rep("PD.wild", nrow(pd.wild.df))
colnames(pd.wild.stats) <- c("Sample", "Stat", "Measure")
mpd.wild.stats <- data.frame(mpd.wild$SampleID, mpd.wild$mpd.obs.z)
mpd.wild.stats$Measure <- rep("MPD SES", nrow(pd.wild.df))
colnames(mpd.wild.stats) <- c("Sample", "Stat", "Measure")


### Prepare PD ###
pd.wild.ready <- merge(pd.wild.stats, meta, by = "Sample")
pd.wild.sum <- pd.wild.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.wild.sum$YMAX <- pd.wild.sum$Mean + pd.wild.sum$SE
pd.wild.sum$YMIN <- pd.wild.sum$Mean - pd.wild.sum$SE


### Prepare MPD ###
mpd.wild.ready <- merge(mpd.wild.stats, meta, by = "Sample")
mpd.wild.sum <- mpd.wild.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.wild.sum$YMAX <- mpd.wild.sum$Mean + mpd.wild.sum$SE
mpd.wild.sum$YMIN <- mpd.wild.sum$Mean - mpd.wild.sum$SE


####### TESTING PD & MPD #######
# For the paired tests, the tests assume that your samples are in the same order (same order of ID for both content and mucosa)
# Make sure you check ID orders!!!

### Test PD ###
hist(pd.wild.ready$Stat, breaks=10)
qqnorm(pd.wild.ready$Stat)
qqline(pd.wild.ready$Stat)
shapiro.test(pd.wild.ready$Stat)
  # p-value = 0.9677
  # Normal
t.test(Stat ~ Sample_Type, data = pd.wild.ready, paired = T)
  # p-value = 0.4559

### Test MPD ###
hist(mpd.wild.ready$Stat, breaks=10)
qqnorm(mpd.wild.ready$Stat)
qqline(mpd.wild.ready$Stat)
shapiro.test(mpd.wild.ready$Stat)
  # p-value = 0.5751
  # Normal
t.test(Stat ~ Sample_Type, data = mpd.wild.ready, paired = T)
  # p-value = 0.07543




########## SHANNON ##########
adiv.wild <- data.frame(sample_data(physeq.wild))

hist(adiv.wild$shannon, breaks=10)
qqnorm(adiv.wild$shannon)
qqline(adiv.wild$shannon)
shapiro.test(adiv.wild$shannon)
  # p-value = 0.4148
  # Normal
t.test(shannon ~ Sample_Type, data = adiv.wild, paired = T)
  # p-value = 0.2124




########## NUMBER OF UNIQUE OTUS ##########
otus.wild <- data.frame(otu_table(physeq.wild))
sampNames.wild <- colnames(otus.wild)
uniq.otus.wild <- data.frame(matrix(nrow = nsamples(physeq.wild), ncol = 2))
colnames(uniq.otus.wild) <- c("Sample", "Unique_OTUs")
for(n in 1:nsamples(physeq.wild)) {
  COL.wild <- otus.wild[,n]
  numUniq.wild <- length(which(COL.wild > 0))
  uniq.otus.wild$Sample[n] <- sampNames.wild[n]
  uniq.otus.wild$Unique_OTUs[n] <- numUniq.wild
}
uniq.otus.wild$Sample_Type <- sample_data(physeq.wild)$Sample_Type
rownames(uniq.otus.wild) <- uniq.otus.wild$Sample


hist(uniq.otus.wild$Unique_OTUs, breaks=10)
qqnorm(uniq.otus.wild$Unique_OTUs)
qqline(uniq.otus.wild$Unique_OTUs)
shapiro.test(uniq.otus.wild$Unique_OTUs)
  # p-value =  0.6322
  # Normal
t.test(Unique_OTUs ~ Sample_Type, data = uniq.otus.wild, paired = T)
  # p-value = 0.4487
```

### Alpha Div - Summer Captive
```{r}
########## FAITH'S PHYLOGENETIC DIVERSITY AND PHYLOGENETIC EVENNESS (MPD) ##########

# Calculate Faith's phylogenetic diversity
pd.sum.res <- pd(t(data.frame(otu_table(physeq.sum))), phy_tree(physeq.sum), 
             include.root = T)
pd.sum.df <- data.frame(pd.sum.res)

# Calculate MPD (Mean Pairwise Distance)
pd.sum.dist <- cophenetic(phy_tree(physeq.sum))
  # Calculate cophenetic distance

ses.mpd.sum.res <- ses.mpd(t(data.frame(otu_table(physeq.sum))), pd.sum.dist, 
                       null.model = "taxa.labels", abundance.weighted = F, runs = 999)
  # Calculate Mpd.sum
  # This'll take a while to run-- be patient

mpd.sum <- data.frame(ses.mpd.sum.res)
  # Pull out MDP results

### Prepare data for plotting ###
mpd.sum$SampleID <- row.names(mpd.sum)
pd.sum.res$SampleID <- row.names(pd.sum.res)
  # Make sure all SampleID's match!


# Pull out first Stat of each test
# PD test = PD
# MPD test = SES (Standardized Effect Size)
pd.sum.stats <- data.frame(pd.sum.res$SampleID, pd.sum.res$PD)
pd.sum.stats$Measure <- rep("PD", nrow(pd.sum.df))
colnames(pd.sum.stats) <- c("Sample", "Stat", "Measure")
mpd.sum.stats <- data.frame(mpd.sum$SampleID, mpd.sum$mpd.obs.z)
mpd.sum.stats$Measure <- rep("MPD SES", nrow(pd.sum.df))
colnames(mpd.sum.stats) <- c("Sample", "Stat", "Measure")


### Prepare PD ###
pd.sum.ready <- merge(pd.sum.stats, meta, by = "Sample")
pd.sum.sum <- pd.sum.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.sum.sum$YMAX <- pd.sum.sum$Mean + pd.sum.sum$SE
pd.sum.sum$YMIN <- pd.sum.sum$Mean - pd.sum.sum$SE


### Prepare MPD ###
mpd.sum.ready <- merge(mpd.sum.stats, meta, by = "Sample")
mpd.sum.sum <- mpd.sum.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.sum.sum$YMAX <- mpd.sum.sum$Mean + mpd.sum.sum$SE
mpd.sum.sum$YMIN <- mpd.sum.sum$Mean - mpd.sum.sum$SE


####### TESTING PD & MPD #######
# For the paired tests, the tests assume that your samples are in the same order (same order of ID for both content and mucosa)
# Make sure you check ID orders!!!

### Test PD ###
hist(pd.sum.ready$Stat, breaks=10)
qqnorm(pd.sum.ready$Stat)
qqline(pd.sum.ready$Stat)
shapiro.test(pd.sum.ready$Stat)
  # p-value = 0.06382
  # Normal
t.test(Stat ~ Sample_Type, data = pd.sum.ready, paired = T)
  # p-value = 0.9252

### Test MPD ###
hist(mpd.sum.ready$Stat, breaks=10)
qqnorm(mpd.sum.ready$Stat)
qqline(mpd.sum.ready$Stat)
shapiro.test(mpd.sum.ready$Stat)
  # p-value = 0.2046
  # Normal
t.test(Stat ~ Sample_Type, data = mpd.sum.ready, paired = T)
  # p-value = 0.3174




########## SHANNON ##########
adiv.sum <- data.frame(sample_data(physeq.sum))

hist(adiv.sum$shannon, breaks=10)
qqnorm(adiv.sum$shannon)
qqline(adiv.sum$shannon)
shapiro.test(adiv.sum$shannon)
  # p-value = 0.1935
  # Normal
t.test(shannon ~ Sample_Type, data = adiv.sum, paired = T)
  # p-value = 0.7101




########## NUMBER OF UNIQUE OTUS ##########
otus.sum <- data.frame(otu_table(physeq.sum))
sampNames.sum <- colnames(otus.sum)
uniq.otus.sum <- data.frame(matrix(nrow = nsamples(physeq.sum), ncol = 2))
colnames(uniq.otus.sum) <- c("Sample", "Unique_OTUs")
for(n in 1:nsamples(physeq.sum)) {
  COL.sum <- otus.sum[,n]
  numUniq.sum <- length(which(COL.sum > 0))
  uniq.otus.sum$Sample[n] <- sampNames.sum[n]
  uniq.otus.sum$Unique_OTUs[n] <- numUniq.sum
}
uniq.otus.sum$Sample_Type <- sample_data(physeq.sum)$Sample_Type
rownames(uniq.otus.sum) <- uniq.otus.sum$Sample


hist(uniq.otus.sum$Unique_OTUs, breaks=10)
qqnorm(uniq.otus.sum$Unique_OTUs)
qqline(uniq.otus.sum$Unique_OTUs)
shapiro.test(uniq.otus.sum$Unique_OTUs)
  # p-value =  0.287
  # Normal
t.test(Unique_OTUs ~ Sample_Type, data = uniq.otus.sum, paired = T)
  # p-value = 0.7555
```



### Alpha Div - Torpor
```{r}
########## FAITH'S PHYLOGENETIC DIVERSITY AND PHYLOGENETIC EVENNESS (MPD) ##########

# Calculate Faith's phylogenetic diversity
pd.tor.res <- pd(t(data.frame(otu_table(physeq.tor))), phy_tree(physeq.tor), 
             include.root = T)
pd.tor.df <- data.frame(pd.tor.res)

# Calculate MPD (Mean Pairwise Distance)
pd.tor.dist <- cophenetic(phy_tree(physeq.tor))
  # Calculate cophenetic distance

ses.mpd.tor.res <- ses.mpd(t(data.frame(otu_table(physeq.tor))), pd.tor.dist, 
                       null.model = "taxa.labels", abundance.weighted = F, runs = 999)
  # Calculate Mpd.tor
  # This'll take a while to run-- be patient

mpd.tor <- data.frame(ses.mpd.tor.res)
  # Pull out MDP results

### Prepare data for plotting ###
mpd.tor$SampleID <- row.names(mpd.tor)
pd.tor.res$SampleID <- row.names(pd.tor.res)
  # Make sure all SampleID's match!


# Pull out first Stat of each test
# PD test = PD
# MPD test = SES (Standardized Effect Size)
pd.tor.stats <- data.frame(pd.tor.res$SampleID, pd.tor.res$PD)
pd.tor.stats$Measure <- rep("PD", nrow(pd.tor.df))
colnames(pd.tor.stats) <- c("Sample", "Stat", "Measure")
mpd.tor.stats <- data.frame(mpd.tor$SampleID, mpd.tor$mpd.obs.z)
mpd.tor.stats$Measure <- rep("MPD SES", nrow(pd.tor.df))
colnames(mpd.tor.stats) <- c("Sample", "Stat", "Measure")


### Prepare PD ###
pd.tor.ready <- merge(pd.tor.stats, meta, by = "Sample")
pd.tor.sum <- pd.tor.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.tor.sum$YMAX <- pd.tor.sum$Mean + pd.tor.sum$SE
pd.tor.sum$YMIN <- pd.tor.sum$Mean - pd.tor.sum$SE


### Prepare MPD ###
mpd.tor.ready <- merge(mpd.tor.stats, meta, by = "Sample")
mpd.tor.sum <- mpd.tor.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.tor.sum$YMAX <- mpd.tor.sum$Mean + mpd.tor.sum$SE
mpd.tor.sum$YMIN <- mpd.tor.sum$Mean - mpd.tor.sum$SE


####### TESTING PD & MPD #######
# For the paired tests, the tests assume that your samples are in the same order (same order of ID for both content and mucosa)
# Make sure you check ID orders!!!

### Test PD ###
hist(pd.tor.ready$Stat, breaks=10)
qqnorm(pd.tor.ready$Stat)
qqline(pd.tor.ready$Stat)
shapiro.test(pd.tor.ready$Stat)
  # p-value = 0.6967
  # Normal
t.test(Stat ~ Sample_Type, data = pd.tor.ready, paired = T)
  # p-value = 0.5243

### Test MPD ###
hist(mpd.tor.ready$Stat, breaks=10)
qqnorm(mpd.tor.ready$Stat)
qqline(mpd.tor.ready$Stat)
shapiro.test(mpd.tor.ready$Stat)
  # p-value = 0.3399
  # Normal
t.test(Stat ~ Sample_Type, data = mpd.tor.ready, paired = T)
  # p-value = 0.4248




########## SHANNON ##########
adiv.tor <- data.frame(sample_data(physeq.tor))

hist(adiv.tor$shannon, breaks=10)
qqnorm(adiv.tor$shannon)
qqline(adiv.tor$shannon)
shapiro.test(adiv.tor$shannon)
  # p-value = 0.3101
  # Normal
t.test(shannon ~ Sample_Type, data = adiv.tor, paired = T)
  # p-value = 0.8631




########## NUMBER OF UNIQUE OTUS ##########
otus.tor <- data.frame(otu_table(physeq.tor))
sampNames.tor <- colnames(otus.tor)
uniq.otus.tor <- data.frame(matrix(nrow = nsamples(physeq.tor), ncol = 2))
colnames(uniq.otus.tor) <- c("Sample", "Unique_OTUs")
for(n in 1:nsamples(physeq.tor)) {
  COL.tor <- otus.tor[,n]
  numUniq.tor <- length(which(COL.tor > 0))
  uniq.otus.tor$Sample[n] <- sampNames.tor[n]
  uniq.otus.tor$Unique_OTUs[n] <- numUniq.tor
}
uniq.otus.tor$Sample_Type <- sample_data(physeq.tor)$Sample_Type
rownames(uniq.otus.tor) <- uniq.otus.tor$Sample


hist(uniq.otus.tor$Unique_OTUs, breaks=10)
qqnorm(uniq.otus.tor$Unique_OTUs)
qqline(uniq.otus.tor$Unique_OTUs)
shapiro.test(uniq.otus.tor$Unique_OTUs)
  # p-value =  0.9582
  # Normal
t.test(Unique_OTUs ~ Sample_Type, data = uniq.otus.tor, paired = T)
  # p-value = 0.6421
```


### Alpha Div - IBA
```{r}
########## FAITH'S PHYLOGENETIC DIVERSITY AND PHYLOGENETIC EVENNESS (MPD) ##########

# Calculate Faith's phylogenetic diversity
pd.iba.res <- pd(t(data.frame(otu_table(physeq.iba))), phy_tree(physeq.iba), 
             include.root = T)
pd.iba.df <- data.frame(pd.iba.res)

# Calculate MPD (Mean Pairwise Distance)
pd.iba.dist <- cophenetic(phy_tree(physeq.iba))
  # Calculate cophenetic distance

ses.mpd.iba.res <- ses.mpd(t(data.frame(otu_table(physeq.iba))), pd.iba.dist, 
                       null.model = "taxa.labels", abundance.weighted = F, runs = 999)
  # Calculate Mpd.iba
  # This'll take a while to run-- be patient

mpd.iba <- data.frame(ses.mpd.iba.res)
  # Pull out MDP results

### Prepare data for plotting ###
mpd.iba$SampleID <- row.names(mpd.iba)
pd.iba.res$SampleID <- row.names(pd.iba.res)
  # Make sure all SampleID's match!


# Pull out first Stat of each test
# PD test = PD
# MPD test = SES (Standardized Effect Size)
pd.iba.stats <- data.frame(pd.iba.res$SampleID, pd.iba.res$PD)
pd.iba.stats$Measure <- rep("PD", nrow(pd.iba.df))
colnames(pd.iba.stats) <- c("Sample", "Stat", "Measure")
mpd.iba.stats <- data.frame(mpd.iba$SampleID, mpd.iba$mpd.obs.z)
mpd.iba.stats$Measure <- rep("MPD SES", nrow(pd.iba.df))
colnames(mpd.iba.stats) <- c("Sample", "Stat", "Measure")


### Prepare PD ###
pd.iba.ready <- merge(pd.iba.stats, meta, by = "Sample")
pd.iba.sum <- pd.iba.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.iba.sum$YMAX <- pd.iba.sum$Mean + pd.iba.sum$SE
pd.iba.sum$YMIN <- pd.iba.sum$Mean - pd.iba.sum$SE


### Prepare MPD ###
mpd.iba.ready <- merge(mpd.iba.stats, meta, by = "Sample")
mpd.iba.sum <- mpd.iba.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.iba.sum$YMAX <- mpd.iba.sum$Mean + mpd.iba.sum$SE
mpd.iba.sum$YMIN <- mpd.iba.sum$Mean - mpd.iba.sum$SE


####### TESTING PD & MPD #######
# For the paired tests, the tests assume that your samples are in the same order (same order of ID for both content and mucosa)
# Make sure you check ID orders!!!

### Test PD ###
hist(pd.iba.ready$Stat, breaks=10)
qqnorm(pd.iba.ready$Stat)
qqline(pd.iba.ready$Stat)
shapiro.test(pd.iba.ready$Stat)
  # p-value = 0.9476
  # Normal
t.test(Stat ~ Sample_Type, data = pd.iba.ready, paired = T)
  # p-value = 0.9544

### Test MPD ###
hist(mpd.iba.ready$Stat, breaks=10)
qqnorm(mpd.iba.ready$Stat)
qqline(mpd.iba.ready$Stat)
shapiro.test(mpd.iba.ready$Stat)
  # p-value = 0.05583
  # Normal
t.test(Stat ~ Sample_Type, data = mpd.iba.ready, paired = T)
  # p-value = 0.4008




########## SHANNON ##########
adiv.iba <- data.frame(sample_data(physeq.iba))

hist(adiv.iba$shannon, breaks=10)
qqnorm(adiv.iba$shannon)
qqline(adiv.iba$shannon)
shapiro.test(adiv.iba$shannon)
  # p-value = 0.2504
  # Normal
t.test(shannon ~ Sample_Type, data = adiv.iba, paired = T)
  # p-value = 0.5366




########## NUMBER OF UNIQUE OTUS ##########
otus.iba <- data.frame(otu_table(physeq.iba))
sampNames.iba <- colnames(otus.iba)
uniq.otus.iba <- data.frame(matrix(nrow = nsamples(physeq.iba), ncol = 2))
colnames(uniq.otus.iba) <- c("Sample", "Unique_OTUs")
for(n in 1:nsamples(physeq.iba)) {
  COL.iba <- otus.iba[,n]
  numUniq.iba <- length(which(COL.iba > 0))
  uniq.otus.iba$Sample[n] <- sampNames.iba[n]
  uniq.otus.iba$Unique_OTUs[n] <- numUniq.iba
}
uniq.otus.iba$Sample_Type <- sample_data(physeq.iba)$Sample_Type
rownames(uniq.otus.iba) <- uniq.otus.iba$Sample


hist(uniq.otus.iba$Unique_OTUs, breaks=10)
qqnorm(uniq.otus.iba$Unique_OTUs)
qqline(uniq.otus.iba$Unique_OTUs)
shapiro.test(uniq.otus.iba$Unique_OTUs)
  # p-value =  0.4646
  # Normal
t.test(Unique_OTUs ~ Sample_Type, data = uniq.otus.iba, paired = T)
  # p-value = 0.5877
```


### Alpha Div - Spring
```{r}
########## FAITH'S PHYLOGENETIC DIVERSITY AND PHYLOGENETIC EVENNESS (MPD) ##########

# Calculate Faith's phylogenetic diversity
pd.spr.res <- pd(t(data.frame(otu_table(physeq.spr))), phy_tree(physeq.spr), 
             include.root = T)
pd.spr.df <- data.frame(pd.spr.res)

# Calculate MPD (Mean Pairwise Distance)
pd.spr.dist <- cophenetic(phy_tree(physeq.spr))
  # Calculate cophenetic distance

ses.mpd.spr.res <- ses.mpd(t(data.frame(otu_table(physeq.spr))), pd.spr.dist, 
                       null.model = "taxa.labels", abundance.weighted = F, runs = 999)
  # Calculate Mpd.spr
  # This'll take a while to run-- be patient

mpd.spr <- data.frame(ses.mpd.spr.res)
  # Pull out MDP results

### Prepare data for plotting ###
mpd.spr$SampleID <- row.names(mpd.spr)
pd.spr.res$SampleID <- row.names(pd.spr.res)
  # Make sure all SampleID's match!


# Pull out first Stat of each test
# PD test = PD
# MPD test = SES (Standardized Effect Size)
pd.spr.stats <- data.frame(pd.spr.res$SampleID, pd.spr.res$PD)
pd.spr.stats$Measure <- rep("PD", nrow(pd.spr.df))
colnames(pd.spr.stats) <- c("Sample", "Stat", "Measure")
mpd.spr.stats <- data.frame(mpd.spr$SampleID, mpd.spr$mpd.obs.z)
mpd.spr.stats$Measure <- rep("MPD SES", nrow(pd.spr.df))
colnames(mpd.spr.stats) <- c("Sample", "Stat", "Measure")


### Prepare PD ###
pd.spr.ready <- merge(pd.spr.stats, meta, by = "Sample")
pd.spr.sum <- pd.spr.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.spr.sum$YMAX <- pd.spr.sum$Mean + pd.spr.sum$SE
pd.spr.sum$YMIN <- pd.spr.sum$Mean - pd.spr.sum$SE


### Prepare MPD ###
mpd.spr.ready <- merge(mpd.spr.stats, meta, by = "Sample")
mpd.spr.sum <- mpd.spr.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.spr.sum$YMAX <- mpd.spr.sum$Mean + mpd.spr.sum$SE
mpd.spr.sum$YMIN <- mpd.spr.sum$Mean - mpd.spr.sum$SE


####### TESTING PD & MPD #######
# For the paired tests, the tests assume that your samples are in the same order (same order of ID for both content and mucosa)
# Make sure you check ID orders!!!

### Test PD ###
hist(pd.spr.ready$Stat, breaks=10)
qqnorm(pd.spr.ready$Stat)
qqline(pd.spr.ready$Stat)
shapiro.test(pd.spr.ready$Stat)
  # p-value = 0.3587
  # Normal
t.test(Stat ~ Sample_Type, data = pd.spr.ready, paired = T)
  # p-value = 0.5265


### Test MPD ###
hist(mpd.spr.ready$Stat, breaks=10)
qqnorm(mpd.spr.ready$Stat)
qqline(mpd.spr.ready$Stat)
shapiro.test(mpd.spr.ready$Stat)
  # p-value = 0.3311
  # Normal
t.test(Stat ~ Sample_Type, data = mpd.spr.ready, paired = T)
  # p-value = 0.3549




########## SHANNON ##########
adiv.spr <- data.frame(sample_data(physeq.spr))

hist(adiv.spr$shannon, breaks=10)
qqnorm(adiv.spr$shannon)
qqline(adiv.spr$shannon)
shapiro.test(adiv.spr$shannon)
  # p-value = 0.3758
  # Normal
t.test(shannon ~ Sample_Type, data = adiv.spr, paired = T)
  # p-value = 0.3927




########## NUMBER OF UNIQUE OTUS ##########
otus.spr <- data.frame(otu_table(physeq.spr))
sampNames.spr <- colnames(otus.spr)
uniq.otus.spr <- data.frame(matrix(nrow = nsamples(physeq.spr), ncol = 2))
colnames(uniq.otus.spr) <- c("Sample", "Unique_OTUs")
for(n in 1:nsamples(physeq.spr)) {
  COL.spr <- otus.spr[,n]
  numUniq.spr <- length(which(COL.spr > 0))
  uniq.otus.spr$Sample[n] <- sampNames.spr[n]
  uniq.otus.spr$Unique_OTUs[n] <- numUniq.spr
}
uniq.otus.spr$Sample_Type <- sample_data(physeq.spr)$Sample_Type
rownames(uniq.otus.spr) <- uniq.otus.spr$Sample


hist(uniq.otus.spr$Unique_OTUs, breaks=10)
qqnorm(uniq.otus.spr$Unique_OTUs)
qqline(uniq.otus.spr$Unique_OTUs)
shapiro.test(uniq.otus.spr$Unique_OTUs)
  # p-value =  0.2606
  # Normal
t.test(Unique_OTUs ~ Sample_Type, data = uniq.otus.spr, paired = T)
  # p-value = 0.7409
```













### Alpha Div - Adjust P
```{r}
p.adjust(c(0.449,0.456,0.075,0.212, # Summer Wild
           0.756,0.925,0.317,0.710, # Summer Captive
           0.642,0.524,0.425,0.863, # Torpor
           0.588,0.954,0.401,0.5366, # IBA
           0.741,0.5265,0.3549,0.3927), # Spring
         method = "fdr")

# Summer Wild - 0.8894118 0.8894118 0.8894118 0.8894118
# Summer Captive - 0.8894118 0.9540000 0.8894118 0.8894118
# Torpor - 0.8894118 0.8894118 0.8894118 0.9540000
# IBA - 0.8894118 0.9540000 0.8894118 0.8894118
# Spring - 0.8894118 0.8894118 0.8894118 0.8894118

```




### Alpha Div - Summer Wild - Prepare Plots
```{r}
###### Unique # of OTUs ######

# Prepare data for plot
uniq.otus.wild.sum <- uniq.otus.wild %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Unique_OTUs),
            SE = se(Unique_OTUs),
            SD = sd(Unique_OTUs),
            Median = median(Unique_OTUs))
uniq.otus.wild.sum$YMAX <- uniq.otus.wild.sum$Mean + uniq.otus.wild.sum$SE
uniq.otus.wild.sum$YMIN <- uniq.otus.wild.sum$Mean - uniq.otus.wild.sum$SE

otu.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

wild.otu.plot <- ggplot(uniq.otus.wild, aes(x = Sample_Type, y = Unique_OTUs, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(640,780), breaks = c(640, 675, 710, 745, 780)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Number of Unique OTUs") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Wild") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = otu.ann, aes(label=lab), x=c(1.5,0),
            y=c(780,0), size=2.5, color="black")






###### Faith's Phylogenetic Diversity ######

# Prepare PD ###
pd.wild.sum <- pd.wild.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.wild.sum$YMAX <- pd.wild.sum$Mean + pd.wild.sum$SE
pd.wild.sum$YMIN <- pd.wild.sum$Mean - pd.wild.sum$SE


pd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

wild.pd.plot <- ggplot(pd.wild.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() + 
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(34,38), breaks = c(34,35,36,37,38)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Faith's Phylogenetic Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Wild") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = pd.ann, aes(label=lab), x=c(1.5,0),
            y=c(38,0), size=2.5, color="black")
  
  

        
###### Phylogenetic Evenness (MPD) ######

# Prepare MPD
mpd.wild.sum <- mpd.wild.ready %>%
  group_by(Group) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.wild.sum$YMAX <- mpd.wild.sum$Mean + mpd.wild.sum$SE
mpd.wild.sum$YMIN <- mpd.wild.sum$Mean - mpd.wild.sum$SE

mpd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

wild.mpd.plot <- ggplot(mpd.wild.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(-2.8,4.4), breaks = c(-2.8, -0.5, 1.8, 4.1)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Phylogenetic Evenness (MPD)") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Wild") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = mpd.ann, aes(label=lab), x=c(1.5,0),
            y=c(4.4,0), size=2.5, color="black")
  

        

###### Shannon's Diversity #####      

# Prepare data for plot
shannon.wild.sum <- adiv.wild %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(shannon),
            SE = se(shannon),
            SD = sd(shannon),
            Median = median(shannon))
shannon.wild.sum$YMAX <- shannon.wild.sum$Mean + shannon.wild.sum$SE
shannon.wild.sum$YMIN <- shannon.wild.sum$Mean - shannon.wild.sum$SE

shannon.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))


wild.shannon.plot <- ggplot(adiv.wild, aes(x = Sample_Type, y = shannon, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(2.0,5.25), breaks = c(2.0,2.8,3.6,4.4,5.2)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Shannon's Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Wild") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        legend.title = element_text(face="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.text = element_text(size=6),
        legend.key.height = unit(3, 'mm'),
        legend.key.width = unit(3, "mm"),
        legend.box.margin=margin(-10,-10,-10,-10)) +
  geom_text(data = shannon.ann, aes(label=lab), x=c(1.5,0),
            y=c(5.25,0), size=2.5, color="black")

```

### Alpha Div - Summer Captive - Prepare Plots
```{r}
###### Unique # of OTUs ######

# Prepare data for plot
uniq.otus.sum.sum <- uniq.otus.sum %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Unique_OTUs),
            SE = se(Unique_OTUs),
            SD = sd(Unique_OTUs),
            Median = median(Unique_OTUs))
uniq.otus.sum.sum$YMAX <- uniq.otus.sum.sum$Mean + uniq.otus.sum.sum$SE
uniq.otus.sum.sum$YMIN <- uniq.otus.sum.sum$Mean - uniq.otus.sum.sum$SE

otu.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

sum.otu.plot <- ggplot(uniq.otus.sum, aes(x = Sample_Type, y = Unique_OTUs, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(290,590), breaks = c(290,390,490,590)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Number of Unique OTUs") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Captive") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = otu.ann, aes(label=lab), x=c(1.5,0),
            y=c(590,0), size=2.5, color="black")






###### Faith's Phylogenetic Diversity ######

# Prepare PD ###
pd.sum.sum <- pd.sum.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.sum.sum$YMAX <- pd.sum.sum$Mean + pd.sum.sum$SE
pd.sum.sum$YMIN <- pd.sum.sum$Mean - pd.sum.sum$SE


pd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

sum.pd.plot <- ggplot(pd.sum.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() + 
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(17,31), breaks = c(17,24,31)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Faith's Phylogenetic Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Captive") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = pd.ann, aes(label=lab), x=c(1.5,0),
            y=c(31,0), size=2.5, color="black")
  
  

        
###### Phylogenetic Evenness (MPD) ######

# Prepare MPD
mpd.sum.sum <- mpd.sum.ready %>%
  group_by(Group) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.sum.sum$YMAX <- mpd.sum.sum$Mean + mpd.sum.sum$SE
mpd.sum.sum$YMIN <- mpd.sum.sum$Mean - mpd.sum.sum$SE

mpd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

sum.mpd.plot <- ggplot(mpd.sum.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(-6.8,1.8), breaks = c(-6.8,-2.5,1.8)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Phylogenetic Evenness (MPD)") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Captive") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = mpd.ann, aes(label=lab), x=c(1.5,0),
            y=c(1.8,0), size=2.5, color="black")
  

        

###### Shannon's Diversity #####      

# Prepare data for plot
shannon.sum.sum <- adiv.sum %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(shannon),
            SE = se(shannon),
            SD = sd(shannon),
            Median = median(shannon))
shannon.sum.sum$YMAX <- shannon.sum.sum$Mean + shannon.sum.sum$SE
shannon.sum.sum$YMIN <- shannon.sum.sum$Mean - shannon.sum.sum$SE

shannon.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))


sum.shannon.plot <- ggplot(adiv.sum, aes(x = Sample_Type, y = shannon, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(1.4,5.75), breaks = c(1.40,2.83,4.26,5.70)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Shannon's Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Summer Captive") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        legend.title = element_text(face="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.text = element_text(size=6),
        legend.key.height = unit(3, 'mm'),
        legend.key.width = unit(3, "mm"),
        legend.box.margin=margin(-10,-10,-10,-10)) +
  geom_text(data = shannon.ann, aes(label=lab), x=c(1.5,0),
            y=c(5.75,0), size=2.5, color="black")

```


### Alpha Div - Torpor - Prepare Plots
```{r}
###### Unique # of OTUs ######

# Prepare data for plot
uniq.otus.tor.sum <- uniq.otus.tor %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Unique_OTUs),
            SE = se(Unique_OTUs),
            SD = sd(Unique_OTUs),
            Median = median(Unique_OTUs))
uniq.otus.tor.sum$YMAX <- uniq.otus.tor.sum$Mean + uniq.otus.tor.sum$SE
uniq.otus.tor.sum$YMIN <- uniq.otus.tor.sum$Mean - uniq.otus.tor.sum$SE

otu.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

tor.otu.plot <- ggplot(uniq.otus.tor, aes(x = Sample_Type, y = Unique_OTUs, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(210,345), breaks = c(210,255,300,345)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Number of Unique OTUs") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Torpor") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = otu.ann, aes(label=lab), x=c(1.5,0),
            y=c(345,0), size=2.5, color="black")






###### Faith's Phylogenetic Diversity ######

# Prepare PD ###
pd.tor.sum <- pd.tor.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.tor.sum$YMAX <- pd.tor.sum$Mean + pd.tor.sum$SE
pd.tor.sum$YMIN <- pd.tor.sum$Mean - pd.tor.sum$SE


pd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

tor.pd.plot <- ggplot(pd.tor.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() + 
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(15.8,20.2), breaks = c(15.8,16.9,18,19.1,20.2)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Faith's Phylogenetic Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Torpor") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = pd.ann, aes(label=lab), x=c(1.5,0),
            y=c(20.2,0), size=2.5, color="black")
  
  

        
###### Phylogenetic Evenness (MPD) ######

# Prepare MPD
mpd.tor.sum <- mpd.tor.ready %>%
  group_by(Group) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.tor.sum$YMAX <- mpd.tor.sum$Mean + mpd.tor.sum$SE
mpd.tor.sum$YMIN <- mpd.tor.sum$Mean - mpd.tor.sum$SE

mpd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

tor.mpd.plot <- ggplot(mpd.tor.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(-0.42,5.40), breaks = c(-0.42,1.52,3.46,5.40)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Phylogenetic Evenness (MPD)") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Torpor") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = mpd.ann, aes(label=lab), x=c(1.5,0),
            y=c(5.4,0), size=2.5, color="black")
  

        

###### Shannon's Diversity #####      

# Prepare data for plot
shannon.tor.sum <- adiv.tor %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(shannon),
            SE = se(shannon),
            SD = sd(shannon),
            Median = median(shannon))
shannon.tor.sum$YMAX <- shannon.tor.sum$Mean + shannon.tor.sum$SE
shannon.tor.sum$YMIN <- shannon.tor.sum$Mean - shannon.tor.sum$SE

shannon.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))


tor.shannon.plot <- ggplot(adiv.tor, aes(x = Sample_Type, y = shannon, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(3.0,5.1), breaks = c(3.0,3.7,4.4,5.1)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Shannon's Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Torpor") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        legend.title = element_text(face="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.text = element_text(size=6),
        legend.key.height = unit(3, 'mm'),
        legend.key.width = unit(3, "mm"),
        legend.box.margin=margin(-10,-10,-10,-10)) +
  geom_text(data = shannon.ann, aes(label=lab), x=c(1.5,0),
            y=c(5.1,0), size=2.5, color="black")

```


### Alpha Div - IBA - Prepare Plots
```{r}
###### Unique # of OTUs ######

# Prepare data for plot
uniq.otus.iba.sum <- uniq.otus.iba %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Unique_OTUs),
            SE = se(Unique_OTUs),
            SD = sd(Unique_OTUs),
            Median = median(Unique_OTUs))
uniq.otus.iba.sum$YMAX <- uniq.otus.iba.sum$Mean + uniq.otus.iba.sum$SE
uniq.otus.iba.sum$YMIN <- uniq.otus.iba.sum$Mean - uniq.otus.iba.sum$SE

otu.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

iba.otu.plot <- ggplot(uniq.otus.iba, aes(x = Sample_Type, y = Unique_OTUs, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(220,390), breaks = c(220,254,288,322,356,390)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Number of Unique OTUs") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("IBA") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = otu.ann, aes(label=lab), x=c(1.5,0),
            y=c(390,0), size=2.5, color="black")






###### Faith's Phylogenetic Diversity ######

# Prepare PD ###
pd.iba.sum <- pd.iba.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.iba.sum$YMAX <- pd.iba.sum$Mean + pd.iba.sum$SE
pd.iba.sum$YMIN <- pd.iba.sum$Mean - pd.iba.sum$SE


pd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

iba.pd.plot <- ggplot(pd.iba.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() + 
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(13.3,22.6), breaks = c(13.3,16.4,19.5,22.6)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Faith's Phylogenetic Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("IBA") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = pd.ann, aes(label=lab), x=c(1.5,0),
            y=c(22.6,0), size=2.5, color="black")
  
  

        
###### Phylogenetic Evenness (MPD) ######

# Prepare MPD
mpd.iba.sum <- mpd.iba.ready %>%
  group_by(Group) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.iba.sum$YMAX <- mpd.iba.sum$Mean + mpd.iba.sum$SE
mpd.iba.sum$YMIN <- mpd.iba.sum$Mean - mpd.iba.sum$SE

mpd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

iba.mpd.plot <- ggplot(mpd.iba.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(-4.5,4.2), breaks = c(-4.50,-2.35,-0.2,1.95,4.1)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Phylogenetic Evenness (MPD)") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("IBA") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = mpd.ann, aes(label=lab), x=c(1.5,0),
            y=c(4.15,0), size=2.5, color="black")
  

        

###### Shannon's Diversity #####      

# Prepare data for plot
shannon.iba.sum <- adiv.iba %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(shannon),
            SE = se(shannon),
            SD = sd(shannon),
            Median = median(shannon))
shannon.iba.sum$YMAX <- shannon.iba.sum$Mean + shannon.iba.sum$SE
shannon.iba.sum$YMIN <- shannon.iba.sum$Mean - shannon.iba.sum$SE

shannon.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))


iba.shannon.plot <- ggplot(adiv.iba, aes(x = Sample_Type, y = shannon, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(2.4,4.8), breaks = c(2.4,3.0,3.6,4.2,4.8)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Shannon's Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("IBA") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        legend.title = element_text(face="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.text = element_text(size=6),
        legend.key.height = unit(3, 'mm'),
        legend.key.width = unit(3, "mm"),
        legend.box.margin=margin(-10,-10,-10,-10)) +
  geom_text(data = shannon.ann, aes(label=lab), x=c(1.5,0),
            y=c(4.8,0), size=2.5, color="black")

```


### Alpha Div - Spring - Prepare Plots
```{r}
###### Unique # of OTUs ######

# Prepare data for plot
uniq.otus.spr.sum <- uniq.otus.spr %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Unique_OTUs),
            SE = se(Unique_OTUs),
            SD = sd(Unique_OTUs),
            Median = median(Unique_OTUs))
uniq.otus.spr.sum$YMAX <- uniq.otus.spr.sum$Mean + uniq.otus.spr.sum$SE
uniq.otus.spr.sum$YMIN <- uniq.otus.spr.sum$Mean - uniq.otus.spr.sum$SE

otu.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

spr.otu.plot <- ggplot(uniq.otus.spr, aes(x = Sample_Type, y = Unique_OTUs, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(310,410), breaks = c(310,335,360,385,410)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Number of Unique OTUs") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Spring") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = otu.ann, aes(label=lab), x=c(1.5,0),
            y=c(410,0), size=2.5, color="black")






###### Faith's Phylogenetic Diversity ######

# Prepare PD ###
pd.spr.sum <- pd.spr.ready %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
pd.spr.sum$YMAX <- pd.spr.sum$Mean + pd.spr.sum$SE
pd.spr.sum$YMIN <- pd.spr.sum$Mean - pd.spr.sum$SE


pd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

spr.pd.plot <- ggplot(pd.spr.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() + 
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(18.6,23.7), breaks = c(18.6,20.3,22,23.7)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Faith's Phylogenetic Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Spring") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = pd.ann, aes(label=lab), x=c(1.5,0),
            y=c(23.7,0), size=2.5, color="black")
  
  

        
###### Phylogenetic Evenness (MPD) ######

# Prepare MPD
mpd.spr.sum <- mpd.spr.ready %>%
  group_by(Group) %>%
  summarize(Mean = mean(Stat),
            SE = se(Stat),
            SD = sd(Stat),
            Median = median(Stat))
mpd.spr.sum$YMAX <- mpd.spr.sum$Mean + mpd.spr.sum$SE
mpd.spr.sum$YMIN <- mpd.spr.sum$Mean - mpd.spr.sum$SE

mpd.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))

spr.mpd.plot <- ggplot(mpd.spr.ready, aes(x = Sample_Type, y = Stat, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(-2.5,2.6), breaks = c(-2.5,-0.8,0.9,2.6)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Phylogenetic Evenness (MPD)") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Spring") +
    theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.position = "none") +
  geom_text(data = mpd.ann, aes(label=lab), x=c(1.5,0),
            y=c(2.6,0), size=2.5, color="black")
  

        

###### Shannon's Diversity #######      

# Prepare data for plot
shannon.spr.sum <- adiv.spr %>%
  group_by(Sample_Type) %>%
  summarize(Mean = mean(shannon),
            SE = se(shannon),
            SD = sd(shannon),
            Median = median(shannon))
shannon.spr.sum$YMAX <- shannon.spr.sum$Mean + shannon.spr.sum$SE
shannon.spr.sum$YMIN <- shannon.spr.sum$Mean - shannon.spr.sum$SE

shannon.ann <- data.frame(lab = c("ns", " "), Sample_Type = factor(c("Content", "Mucosa")))


spr.shannon.plot <- ggplot(adiv.spr, aes(x = Sample_Type, y = shannon, fill = Sample_Type)) +
  geom_violin() +
  geom_dotplot(binaxis = 'y', stackdir = 'center', dotsize = 1, stackratio = 1.15, fill = "black") +
  scale_fill_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  scale_y_continuous(limits = c(3.3,4.5), breaks = c(3.3,3.7,4.1,4.5)) +
  scale_x_discrete(labels = c("Content", "Mucosa")) +
  ylab("Shannon's Diversity") + xlab("Sample Type") + labs(fill = "Sample Type") +
  ggtitle("Spring") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        strip.text = element_text(face="bold", size=6),
        strip.text.x = element_text(face ="bold", size=6),
        legend.title = element_text(face="bold", size=6),
        axis.title.x = element_text(face="bold", size=6),
        axis.title.y = element_text(face="bold", size=6),
        axis.text.x = element_text(size=6),
        axis.text.y = element_text(size=6),
        plot.title = element_text(face = "bold", size = 6, hjust = 0.5, margin=margin(-5,0,0,0)),
        legend.text = element_text(size=6),
        legend.key.height = unit(3, 'mm'),
        legend.key.width = unit(3, "mm"),
        legend.box.margin=margin(-10,-10,-10,-10)) +
  geom_text(data = shannon.ann, aes(label=lab), x=c(1.5,0),
            y=c(4.5,0), size=2.5, color="black")

```

### Plot - Alpha-Diversity
```{r}
tiff("ConMuc.adiv.tiff", width = 170, height = 225, units = "mm", res = 600)
grid.newpage()
pushViewport(viewport(layout=grid.layout(10,4, widths = c(1, 1, 1, 1.4),
                                         heights = c(0.07,1.5,0.07,1.5,0.07,1.5,0.07,1.5,0.07,1.5))))
grid.text("A", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=1, layout.pos.col=1),
          gp=gpar(fontsize=8,fontface="bold"))
print(wild.otu.plot, vp=viewport(layout.pos.row=2, layout.pos.col=1))
grid.text("B", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=1, layout.pos.col=2),
          gp=gpar(fontsize=8,fontface="bold"))
print(wild.pd.plot, vp=viewport(layout.pos.row=2, layout.pos.col=2))
grid.text("C", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=1, layout.pos.col=3),
          gp=gpar(fontsize=8,fontface="bold"))
print(wild.mpd.plot, vp=viewport(layout.pos.row=2, layout.pos.col=3))
grid.text("D", x=unit(0.045, "npc"), vp=viewport(layout.pos.row=1, layout.pos.col=4),
          gp=gpar(fontsize=8,fontface="bold"))
print(wild.shannon.plot, vp=viewport(layout.pos.row=2, layout.pos.col=4))


grid.text("E", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=3, layout.pos.col=1),
          gp=gpar(fontsize=8,fontface="bold"))
print(sum.otu.plot, vp=viewport(layout.pos.row=4, layout.pos.col=1))
grid.text("F", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=3, layout.pos.col=2),
          gp=gpar(fontsize=8,fontface="bold"))
print(sum.pd.plot, vp=viewport(layout.pos.row=4, layout.pos.col=2))
grid.text("G", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=3, layout.pos.col=3),
          gp=gpar(fontsize=8,fontface="bold"))
print(sum.mpd.plot, vp=viewport(layout.pos.row=4, layout.pos.col=3))
grid.text("H", x=unit(0.045, "npc"), vp=viewport(layout.pos.row=3, layout.pos.col=4),
          gp=gpar(fontsize=8,fontface="bold"))
print(sum.shannon.plot, vp=viewport(layout.pos.row=4, layout.pos.col=4))


grid.text("I", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=5, layout.pos.col=1),
          gp=gpar(fontsize=8,fontface="bold"))
print(tor.otu.plot, vp=viewport(layout.pos.row=6, layout.pos.col=1))
grid.text("J", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=5, layout.pos.col=2),
          gp=gpar(fontsize=8,fontface="bold"))
print(tor.pd.plot, vp=viewport(layout.pos.row=6, layout.pos.col=2))
grid.text("K", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=5, layout.pos.col=3),
          gp=gpar(fontsize=8,fontface="bold"))
print(tor.mpd.plot, vp=viewport(layout.pos.row=6, layout.pos.col=3))
grid.text("L", x=unit(0.045, "npc"), vp=viewport(layout.pos.row=5, layout.pos.col=4),
          gp=gpar(fontsize=8,fontface="bold"))
print(tor.shannon.plot, vp=viewport(layout.pos.row=6, layout.pos.col=4))



grid.text("M", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=7, layout.pos.col=1),
          gp=gpar(fontsize=8,fontface="bold"))
print(iba.otu.plot, vp=viewport(layout.pos.row=8, layout.pos.col=1))
grid.text("N", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=7, layout.pos.col=2),
          gp=gpar(fontsize=8,fontface="bold"))
print(iba.pd.plot, vp=viewport(layout.pos.row=8, layout.pos.col=2))
grid.text("O", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=7, layout.pos.col=3),
          gp=gpar(fontsize=8,fontface="bold"))
print(iba.mpd.plot, vp=viewport(layout.pos.row=8, layout.pos.col=3))
grid.text("P", x=unit(0.045, "npc"), vp=viewport(layout.pos.row=7, layout.pos.col=4),
          gp=gpar(fontsize=8,fontface="bold"))
print(iba.shannon.plot, vp=viewport(layout.pos.row=8, layout.pos.col=4))


grid.text("Q", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=9, layout.pos.col=1),
          gp=gpar(fontsize=8,fontface="bold"))
print(spr.otu.plot, vp=viewport(layout.pos.row=10, layout.pos.col=1))
grid.text("R", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=9, layout.pos.col=2),
          gp=gpar(fontsize=8,fontface="bold"))
print(spr.pd.plot, vp=viewport(layout.pos.row=10, layout.pos.col=2))
grid.text("S", x=unit(0.06, "npc"), vp=viewport(layout.pos.row=9, layout.pos.col=3),
          gp=gpar(fontsize=8,fontface="bold"))
print(spr.mpd.plot, vp=viewport(layout.pos.row=10, layout.pos.col=3))
grid.text("T", x=unit(0.045, "npc"), vp=viewport(layout.pos.row=9, layout.pos.col=4),
          gp=gpar(fontsize=8,fontface="bold"))
print(spr.shannon.plot, vp=viewport(layout.pos.row=10, layout.pos.col=4))
dev.off()
```
























### Beta Div - Summer Wild
```{r}
########## Weighted UniFrac ##########
UF.w.wild <- phyloseq::distance(physeq = physeq.wild, method = "wunifrac")

sampdf <- data.frame(sample_data(physeq.wild))
beta.tax <- betadisper(d=UF.w.wild, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.9013889
adonis(UF.w.wild ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.01667, R2 = 0.53348
  # Sample_Type P = 0.60556, R2 = 0.07401





########## Unweighted UniFrac ##########
UF.u.wild <- phyloseq::distance(physeq = physeq.wild, method = "unifrac")

sampdf <- data.frame(sample_data(physeq.wild))
beta.tax <- betadisper(d=UF.u.wild, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.1013889
adonis(UF.u.wild ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.05, R2 = 0.40122
  # Sample_Type: P = 0.6056, R2 = 0.08301




########## Bray-Curtis ##########
sampdf <- data.frame(sample_data(physeq.wild))
bray.wild <- phyloseq::distance(physeq = physeq.wild, method = "bray")
beta.tax <- betadisper(d = bray.wild, group = sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.9013889
adonis(bray.wild ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.05556, R2 = 0.50378
  # Sample_Type: P = 0.60556, R2 = 0.03878
```

### Beta Div - Summer Captive
```{r}
########## Weighted UniFrac ##########
UF.w.sum <- phyloseq::distance(physeq = physeq.sum, method = "wunifrac")
UF.w.sum.pcoa <- ordinate(physeq = physeq.sum, method = "PCoA", distance = "wunifrac")

sampdf <- data.frame(sample_data(physeq.sum))
beta.tax <- betadisper(d=UF.w.sum, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.124
adonis(UF.w.sum ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.0001, R2 = 0.24467
  # Sample_Type P = 0.5519, R2 = 0.05572





########## Unweighted UniFrac ##########
UF.u.sum <- phyloseq::distance(physeq = physeq.sum, method = "unifrac")
UF.u.sum.pcoa <- ordinate(physeq = physeq.sum, method = "PCoA", distance = "unifrac")

sampdf <- data.frame(sample_data(physeq.sum))
beta.tax <- betadisper(d=UF.u.sum, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.791
adonis(UF.u.sum ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0002, R2 = 0.23953
  # Sample_Type: P = 0.9521, R2 = 0.02428




########## Bray-Curtis ##########
bray.sum.pcoa <- ordinate(physeq=physeq.sum, method="PCoA", distance="bray")

sampdf <- data.frame(sample_data(physeq.sum))
bray.sum <- phyloseq::distance(physeq = physeq.sum, method = "bray")
beta.tax <- betadisper(d = bray.sum, group = sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.389
adonis(bray.sum ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0001, R2 = 0.22428
  # Sample_Type: P = 0.9028, R2 = 0.03305
```



### Beta Div - Torpor
```{r}
########## Weighted UniFrac ##########
UF.w.tor <- phyloseq::distance(physeq = physeq.tor, method = "wunifrac")
UF.w.tor.pcoa <- ordinate(physeq = physeq.tor, method = "PCoA", distance = "wunifrac")

sampdf <- data.frame(sample_data(physeq.tor))
beta.tax <- betadisper(d=UF.w.tor, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.323
adonis(UF.w.tor ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.2592, R2 = 0.16036
  # Sample_Type P = 0.8740, R2 = 0.01962





########## Unweighted UniFrac ##########
UF.u.tor <- phyloseq::distance(physeq = physeq.tor, method = "unifrac")
UF.u.tor.pcoa <- ordinate(physeq = physeq.tor, method = "PCoA", distance = "unifrac")

sampdf <- data.frame(sample_data(physeq.tor))
beta.tax <- betadisper(d=UF.u.tor, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.027
  # Not significant after fdr, so I'll go with PERMANOVA
adonis(UF.u.tor ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0133, R2 = 0.26324
  # Sample Type: P = 0.8757, R2 = 0.03934

anosim(UF.u.tor, sampdf$Sample_Type, permutations = 9999)
  # P-value = 0.7806
anosim(UF.u.tor, sampdf$ID, permutations = 9999)
  # P-value = 0.001
###(UF.u.tor ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0121, R2 = 0.26324
  # Sample_Type: P = 0.8711, R2 = 0.03934




########## Bray-Curtis ##########
bray.tor.pcoa <- ordinate(physeq=physeq.tor, method="PCoA", distance="bray")

sampdf <- data.frame(sample_data(physeq.tor))
bray.tor <- phyloseq::distance(physeq = physeq.tor, method = "bray")
beta.tax <- betadisper(d = bray.tor, group = sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.406
adonis(bray.tor ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0845, R2 = 0.23260
  # Sample_Type: P = 0.8687, R2 = 0.01358
```



### Beta Div - IBA
```{r}
########## Weighted UniFrac ##########
UF.w.iba <- phyloseq::distance(physeq = physeq.iba, method = "wunifrac")
UF.w.iba.pcoa <- ordinate(physeq = physeq.iba, method = "PCoA", distance = "wunifrac")

sampdf <- data.frame(sample_data(physeq.iba))
beta.tax <- betadisper(d=UF.w.iba, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.832
adonis(UF.w.iba ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.0108, R2 = 0.23228
  # Sample_Type P = 0.9322, R2 = 0.01868





########## Unweighted UniFrac ##########
UF.u.iba <- phyloseq::distance(physeq = physeq.iba, method = "unifrac")
UF.u.iba.pcoa <- ordinate(physeq = physeq.iba, method = "PCoA", distance = "unifrac")

sampdf <- data.frame(sample_data(physeq.iba))
beta.tax <- betadisper(d=UF.u.iba, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.644
adonis(UF.u.iba ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.0167, R2 = 0.15848
  # Sample_Type P = 0.9638, R2 = 0.02947



########## Bray-Curtis ##########
bray.iba.pcoa <- ordinate(physeq=physeq.iba, method="PCoA", distance="bray")

sampdf <- data.frame(sample_data(physeq.iba))
bray.iba <- phyloseq::distance(physeq = physeq.iba, method = "bray")
beta.tax <- betadisper(d = bray.iba, group = sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.936
adonis(bray.iba ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.0011, R2 = 0.26414
  # Sample_Type: P = 0.9554, R2 = 0.01095
```



### Beta Div - Spring
```{r}
########## Weighted UniFrac ##########
UF.w.spr <- phyloseq::distance(physeq = physeq.spr, method = "wunifrac")

sampdf <- data.frame(sample_data(physeq.spr))
beta.tax <- betadisper(d=UF.w.spr, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.5013889
adonis(UF.w.spr ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.2028, R2 = 0.38553
  # Sample_Type P = 0.6444, R2 = 0.03608



########## Unweighted UniFrac ##########
UF.u.spr <- phyloseq::distance(physeq = physeq.spr, method = "unifrac")

sampdf <- data.frame(sample_data(physeq.spr))
beta.tax <- betadisper(d=UF.u.spr, group=sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.8013889
adonis(UF.u.spr ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID P = 0.04167, R2 = 0.47220
  # Sample_Type P = 0.60833, R2 = 0.06016



########## Bray-Curtis ##########
bray.spr.pcoa <- ordinate(physeq=physeq.spr, method="PCoA", distance="bray")

sampdf <- data.frame(sample_data(physeq.spr))
bray.spr <- phyloseq::distance(physeq = physeq.spr, method = "bray")
beta.tax <- betadisper(d = bray.spr, group = sampdf$Sample_Type)
p <- permutest(beta.tax)
p$tab
  # p-value = 0.5013889
adonis(bray.spr ~ ID + Sample_Type, data = sampdf, permutations = 9999)
  # ID: P = 0.2139, R2 = 0.39772
  # Sample_Type: P = 0.6889, R2 = 0.02878
```


### Beta Div - Adjust P
```{r}
# Betadisper
p.adjust(c(0.901,0.101,0.901, # Summer Wild
           0.124,0.791,0.039, # Summer Captive
           0.300,0.027,0.406, # Torpor
           0.832,0.644,0.936, # IBA
           0.5013889,0.8013889,0.5013889), # Spring
         method = "fdr")
  # Summer Wild = 0.9360 0.4650 0.9360
  # Summer Captive = 0.4650 0.9360 0.2925
  # Torpor = 0.9000 0.2925 0.9360
  # IBA = 0.9360 0.9360 0.9360
  # Spring = 0.9360 0.9360 0.9360

# PERMANOVA/ANOSIM
p.adjust(c(0.01667,0.60556,0.05,0.6056,0.05556,0.60556, # Summer Wild
           0.0001,0.5519,0.0002,0.9521,0.0001,0.9028, # Summer Captive
           0.2592,0.874,0.0133,0.8757,0.0845,0.8687, # Torpor
           0.0108,0.9332,0.0167,0.9638,0.001,0.9554, # IBA
           0.2028,0.6444,0.04167,0.60833,0.2139,0.6889), # Spring
         method = "fdr")
  # Summer Wild = 0.0626250 0.9124950 0.1500000 0.9124950 0.1515273 0.9124950
  # Summer Captive = 0.0015000 0.9124950 0.0020000 0.9638000 0.0015000 0.9638000
  # Torpor = 0.5184000 0.9638000 0.0626250 0.9638000 0.2112500 0.9638000
  # IBA = 0.0540000 0.9638000 0.0626250 0.9638000 0.0060000 0.9638000
  # Spring = 0.4583571 0.9205714 0.1389000 0.9124950 0.4583571 0.9394091

```
### Beta Div - Summer Wild - Prepare Plots
```{r}
### Weighted UniFrac ###
UF.w.wild <- phyloseq::distance(physeq = physeq.wild, method = "wunifrac")
UF.w.wild.pcoa <- ordinate(physeq = physeq.wild, method = "PCoA", distance = "wunifrac")
  # Variation explained = 89.7%

wild.wUF.plot <- plot_ordination(physeq = physeq.wild, ordination = UF.w.wild.pcoa, axes = c(1,2),
                                 color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Wild\nWeighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Unweighted UniFrac ###
UF.u.wild <- phyloseq::distance(physeq = physeq.wild, method = "unifrac")
UF.u.wild.pcoa <- ordinate(physeq = physeq.wild, method = "PCoA", distance = "unifrac")
  # Variation explained = 78.1%

wild.uUF.plot <- plot_ordination(physeq = physeq.wild, ordination = UF.u.wild.pcoa, axes = c(1,2),
                                 color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Wild\nUnweighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Bray-Curtis ###
bray.wild.pcoa <- ordinate(physeq=physeq.wild, method="PCoA", distance="bray")
  # Variation explained = 92.6%
wild.bc.plot <- plot_ordination(physeq=physeq.wild, ordination=bray.wild.pcoa, color="Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Wild\nBray-Curtis Dissimilarity") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.position = "none"
        #legend.title = element_text(size = 8, face = "bold"),
        #legend.text = element_text(size = 8),
        #legend.key.height = unit(4, 'mm'),
        #legend.box.margin=margin(-10,-10,-10,-10)
        )
```

### Beta Div - Summer Captive - Prepare Plots
```{r}
### Weighted UniFrac ###
UF.w.sum <- phyloseq::distance(physeq = physeq.sum, method = "wunifrac")
UF.w.sum.pcoa <- ordinate(physeq = physeq.sum, method = "PCoA", distance = "wunifrac")
  # Variation explained = 50.9%

sum.wUF.plot <- plot_ordination(physeq = physeq.sum, ordination = UF.w.sum.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Captive\nWeighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Unweighted UniFrac ###
UF.u.sum <- phyloseq::distance(physeq = physeq.sum, method = "unifrac")
UF.u.sum.pcoa <- ordinate(physeq = physeq.sum, method = "PCoA", distance = "unifrac")
  # Variation explained = 47%

sum.uUF.plot <- plot_ordination(physeq = physeq.sum, ordination = UF.u.sum.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Captive\nUnweighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Bray-Curtis ###
bray.sum.pcoa <- ordinate(physeq=physeq.sum, method="PCoA", distance="bray")
  # Variation explained = 48.9%

sum.bc.plot <- plot_ordination(physeq=physeq.sum, ordination=bray.sum.pcoa, color="Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Summer Captive\nBray-Curtis Dissimilarity") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.position = "none"
        #legend.title = element_text(size = 8, face = "bold"),
        #legend.text = element_text(size = 8),
        #legend.key.height = unit(4, 'mm'),
        #legend.box.margin=margin(-10,-10,-10,-10)
        )

```

### Beta Div - Torpor - Prepare Plots
```{r}
### Weighted UniFrac ###
UF.w.tor <- phyloseq::distance(physeq = physeq.tor, method = "wunifrac")
UF.w.tor.pcoa <- ordinate(physeq = physeq.tor, method = "PCoA", distance = "wunifrac")
  # Variation explained = 75.8%

tor.wUF.plot <- plot_ordination(physeq = physeq.tor, ordination = UF.w.tor.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Torpor\nWeighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Unweighted UniFrac ###
UF.u.tor <- phyloseq::distance(physeq = physeq.tor, method = "unifrac")
UF.u.tor.pcoa <- ordinate(physeq = physeq.tor, method = "PCoA", distance = "unifrac")
  # Variation explained = 56.1%

tor.uUF.plot <- plot_ordination(physeq = physeq.tor, ordination = UF.u.tor.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Torpor\nUnweighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Bray-Curtis ###
bray.tor.pcoa <- ordinate(physeq=physeq.tor, method="PCoA", distance="bray")
  # Variation explained = 69.7%

tor.bc.plot <- plot_ordination(physeq=physeq.tor, ordination=bray.tor.pcoa, color="Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Torpor\nBray-Curtis Dissimilarity") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.position = "none"
        #legend.title = element_text(size = 8, face = "bold"),
        #legend.text = element_text(size = 8),
        #legend.key.height = unit(4, 'mm'),
        #legend.box.margin=margin(-10,-10,-10,-10)
        )

```


### Beta Div - IBA - Prepare Plots
```{r}
### Weighted UniFrac ###
UF.w.iba <- phyloseq::distance(physeq = physeq.iba, method = "wunifrac")
UF.w.iba.pcoa <- ordinate(physeq = physeq.iba, method = "PCoA", distance = "wunifrac")
  # Variation explained = 64.2%

iba.wUF.plot <- plot_ordination(physeq = physeq.iba, ordination = UF.w.iba.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("IBA\nWeighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Unweighted UniFrac ###
UF.u.iba <- phyloseq::distance(physeq = physeq.iba, method = "unifrac")
UF.u.iba.pcoa <- ordinate(physeq = physeq.iba, method = "PCoA", distance = "unifrac")
  # Variation explained = 41.2%

iba.uUF.plot <- plot_ordination(physeq = physeq.iba, ordination = UF.u.iba.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("IBA\nUnweighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Bray-Curtis ###
bray.iba.pcoa <- ordinate(physeq=physeq.iba, method="PCoA", distance="bray")
  # Variation explained = 61.6%
iba.bc.plot <- plot_ordination(physeq=physeq.iba, ordination=bray.iba.pcoa, color="Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("IBA\nBray-Curtis Dissimilarity") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.position = "none"
        #legend.title = element_text(size = 8, face = "bold"),
        #legend.text = element_text(size = 8),
        #legend.key.height = unit(4, 'mm'),
        #legend.box.margin=margin(-10,-10,-10,-10)
        )

```



### Beta Div - Spring - Prepare Plots
```{r}
### Weighted UniFrac ###
UF.w.spr <- phyloseq::distance(physeq = physeq.spr, method = "wunifrac")
UF.w.spr.pcoa <- ordinate(physeq = physeq.spr, method = "PCoA", distance = "wunifrac")
  # Variation explained = 91.5%

spr.wUF.plot <- plot_ordination(physeq = physeq.spr, ordination = UF.w.spr.pcoa, axes = c(1,2),
                                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Spring\nWeighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Unweighted UniFrac ###
UF.u.spr <- phyloseq::distance(physeq = physeq.spr, method = "unifrac")
UF.u.spr.pcoa <- ordinate(physeq = physeq.spr, method = "PCoA", distance = "unifrac")
  # Variation explained = 86%

spr.uUF.plot <- plot_ordination(physeq = physeq.spr, ordination = UF.u.spr.pcoa, axes = c(1,2),
                color = "Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Spring\nUnweighted UniFrac") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.title = element_text(face = "bold", size = 8),
        legend.position = "none"
        )



### Bray-Curtis ###
bray.spr.pcoa <- ordinate(physeq=physeq.spr, method="PCoA", distance="bray")
  # Variation explained = 91.7%

spr.bc.plot <- plot_ordination(physeq=physeq.spr, ordination=bray.spr.pcoa, color="Sample_Type") +
  scale_colour_manual(values = c("gray60", "gray90"), labels = c("Content", "Mucosa")) +
  labs(color = "Sample Type") + ggtitle("Spring\nBray-Curtis Dissimilarity") +
  geom_point(size = 3) + geom_point(size=3, colour = "black", shape = 21) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.background = element_blank(),
        axis.title.x = element_text(size = 6),
        axis.title.y = element_text(size = 6),
        axis.text.x = element_text(size = 6, colour = "black"),
        axis.text.y = element_text(size = 6, colour = "black"),
        plot.title = element_text(hjust = 0.5, size = 8, face = "bold"),
        legend.position = "none"
        #legend.title = element_text(size = 8, face = "bold"),
        #legend.text = element_text(size = 8),
        #legend.key.height = unit(4, 'mm'),
        #legend.box.margin=margin(-10,-10,-10,-10)
        )

```



### Plot - Beta-Diversity
```{r}
tiff("ConMuc.bdiv.tiff", width = 170, height = 225, units = "mm", res = 600)
grid.newpage()
pushViewport(viewport(layout=grid.layout(10,4, widths = c(1, 1, 1, 0.4), heights = c(0.04, 1,0.03,1,0.03,1,0.03,1,0.03,1))))

print(wild.wUF.plot, vp=viewport(layout.pos.row=2, layout.pos.col=1))
print(wild.uUF.plot, vp=viewport(layout.pos.row=2, layout.pos.col=2))
print(wild.bc.plot, vp=viewport(layout.pos.row=2, layout.pos.col=3))

print(sum.wUF.plot, vp=viewport(layout.pos.row=4, layout.pos.col=1))
print(sum.uUF.plot, vp=viewport(layout.pos.row=4, layout.pos.col=2))
print(sum.bc.plot, vp=viewport(layout.pos.row=4, layout.pos.col=3))

print(tor.wUF.plot, vp=viewport(layout.pos.row=6, layout.pos.col=1))
print(tor.uUF.plot, vp=viewport(layout.pos.row=6, layout.pos.col=2))
print(tor.bc.plot, vp=viewport(layout.pos.row=6, layout.pos.col=3))

print(iba.wUF.plot, vp=viewport(layout.pos.row=8, layout.pos.col=1))
print(iba.uUF.plot, vp=viewport(layout.pos.row=8, layout.pos.col=2))
print(iba.bc.plot, vp=viewport(layout.pos.row=8, layout.pos.col=3))

print(spr.wUF.plot, vp=viewport(layout.pos.row=10, layout.pos.col=1))
print(spr.uUF.plot, vp=viewport(layout.pos.row=10, layout.pos.col=2))
print(spr.bc.plot, vp=viewport(layout.pos.row=10, layout.pos.col=3))



ord.legend$vp <- viewport(layout.pos.row = 2, layout.pos.col = 4)
grid.draw(ord.legend)
ord.legend$vp <- viewport(layout.pos.row = 4, layout.pos.col = 4)
grid.draw(ord.legend)
ord.legend$vp <- viewport(layout.pos.row = 6, layout.pos.col = 4)
grid.draw(ord.legend)
ord.legend$vp <- viewport(layout.pos.row = 8, layout.pos.col = 4)
grid.draw(ord.legend)
ord.legend$vp <- viewport(layout.pos.row = 10, layout.pos.col = 4)
grid.draw(ord.legend)



grid.text("A", x=unit(0.05, "npc"), y=unit(0.2, "npc"), vp=viewport(layout.pos.row=1,
                                                                  layout.pos.col=1),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("B", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=1,
                                                                   layout.pos.col=2),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("C", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=1,
                                                                   layout.pos.col=3),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("D", x=unit(0.05, "npc"), y=unit(0.2, "npc"), vp=viewport(layout.pos.row=3,
                                                                  layout.pos.col=1),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("E", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=3,
                                                                   layout.pos.col=2),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("F", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=3,
                                                                   layout.pos.col=3),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("G", x=unit(0.05, "npc"), y=unit(0.2, "npc"), vp=viewport(layout.pos.row=5,
                                                                  layout.pos.col=1),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("H", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=5,
                                                                   layout.pos.col=2),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("I", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=5,
                                                                   layout.pos.col=3),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("J", x=unit(0.05, "npc"), y=unit(0.2, "npc"), vp=viewport(layout.pos.row=7,
                                                                  layout.pos.col=1),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("K", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=7,
                                                                   layout.pos.col=2),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("L", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=7,
                                                                   layout.pos.col=3),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("M", x=unit(0.05, "npc"), y=unit(0.2, "npc"), vp=viewport(layout.pos.row=9,
                                                                  layout.pos.col=1),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("N", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=9,
                                                                   layout.pos.col=2),
          gp=gpar(fontsize=10,fontface="bold"))
grid.text("O", x=unit(0.05, "npc"),  y=unit(0.2, "npc"), vp=viewport(layout.pos.row=9,
                                                                   layout.pos.col=3),
          gp=gpar(fontsize=10,fontface="bold"))

dev.off()
```